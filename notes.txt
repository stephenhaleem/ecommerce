# Building a Complete E-Commerce Web App
## Class Notes - Web Development

---

## ðŸŽ¯ What We're Building

A fully functional e-commerce website where users can:
- Browse products
- Add items to cart
- Create an account and login
- Make payments securely
- View their order history

**Tech Stack:**
- **Frontend:** HTML, CSS, JavaScript
- **Backend/Database:** Supabase
- **Payment:** Paystack or Flutterwave

---

## ðŸ“š Table of Contents

1. Project Overview
2. Setting Up Supabase
3. Frontend Structure
4. User Authentication
5. Product Display & Management
6. Shopping Cart Functionality
7. Payment Integration
8. Order Management
9. Best Practices & Security

---

## 1. Project Overview

### What is Supabase?
Supabase is an open-source Firebase alternative that provides:
- **PostgreSQL Database** - Store products, users, orders
- **Authentication** - Built-in user login/signup
- **Real-time subscriptions** - Live updates
- **Storage** - For product images
- **Row Level Security** - Protect your data

### What is Paystack/Flutterwave?
Both are African payment gateways that allow you to accept payments via:
- Debit/Credit cards
- Bank transfers
- Mobile money
- USSD

**Choosing between them:**
- **Paystack** - Better for Nigeria, Ghana, South Africa, Kenya
- **Flutterwave** - Wider African coverage (150+ countries)

---

## 2. Setting Up Supabase

### Step 1: Create a Supabase Project

1. Go to [supabase.com](https://supabase.com)
2. Sign up/Login
3. Click "New Project"
4. Fill in:
   - Project name: `my-ecommerce-store`
   - Database password: (save this!)
   - Region: Choose closest to your location

### Step 2: Database Schema

Create these tables in your Supabase SQL Editor:

#### **Products Table**
```sql
CREATE TABLE products (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  price DECIMAL(10,2) NOT NULL,
  image_url TEXT,
  stock_quantity INTEGER DEFAULT 0,
  category TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### **Orders Table**
```sql
CREATE TABLE orders (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  total_amount DECIMAL(10,2) NOT NULL,
  status TEXT DEFAULT 'pending',
  payment_reference TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### **Order Items Table**
```sql
CREATE TABLE order_items (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  order_id UUID REFERENCES orders(id),
  product_id UUID REFERENCES products(id),
  quantity INTEGER NOT NULL,
  price DECIMAL(10,2) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### Step 3: Get Your API Keys

1. Go to Project Settings â†’ API
2. Copy these values:
   - **Project URL** - Your Supabase backend URL
   - **Anon/Public Key** - Safe to use in frontend

---

## 3. Frontend Structure

### File Organization
```
ecommerce-app/
â”‚
â”œâ”€â”€ index.html           # Homepage with products
â”œâ”€â”€ login.html           # Login page
â”œâ”€â”€ signup.html          # Registration page
â”œâ”€â”€ cart.html            # Shopping cart
â”œâ”€â”€ checkout.html        # Payment page
â”œâ”€â”€ orders.html          # Order history
â”‚
â”œâ”€â”€ css/
â”‚   â””â”€â”€ styles.css       # All styles
â”‚
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ config.js        # Supabase config
â”‚   â”œâ”€â”€ auth.js          # Authentication logic
â”‚   â”œâ”€â”€ products.js      # Product display
â”‚   â”œâ”€â”€ cart.js          # Cart management
â”‚   â””â”€â”€ payment.js       # Payment integration
â”‚
â””â”€â”€ images/              # Product images
```

### Basic HTML Template

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My E-Commerce Store</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="logo">MyStore</div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>
            <li><a href="#" id="auth-link">Login</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main id="content">
        <!-- Dynamic content goes here -->
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
</body>
</html>
```

---

## 4. User Authentication

### config.js - Supabase Setup

```javascript
// Replace with your actual Supabase credentials
const SUPABASE_URL = 'https://your-project.supabase.co';
const SUPABASE_ANON_KEY = 'your-anon-key-here';

// Initialize Supabase client
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
```

### auth.js - Sign Up Function

```javascript
// Sign up new user
async function signUp(email, password, fullName) {
    try {
        const { data, error } = await supabase.auth.signUp({
            email: email,
            password: password,
            options: {
                data: {
                    full_name: fullName
                }
            }
        });

        if (error) {
            alert('Error: ' + error.message);
            return;
        }

        alert('Sign up successful! Please check your email to verify.');
        window.location.href = 'login.html';
    } catch (err) {
        console.error('Sign up error:', err);
    }
}

// Usage in signup.html
document.getElementById('signup-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const fullName = document.getElementById('fullName').value;
    
    await signUp(email, password, fullName);
});
```

### Login Function

```javascript
async function login(email, password) {
    try {
        const { data, error } = await supabase.auth.signInWithPassword({
            email: email,
            password: password
        });

        if (error) {
            alert('Login failed: ' + error.message);
            return;
        }

        alert('Login successful!');
        window.location.href = 'index.html';
    } catch (err) {
        console.error('Login error:', err);
    }
}
```

### Check if User is Logged In

```javascript
async function checkAuth() {
    const { data: { user } } = await supabase.auth.getUser();
    
    if (user) {
        // User is logged in
        document.getElementById('auth-link').textContent = 'Logout';
        document.getElementById('auth-link').href = '#';
        document.getElementById('auth-link').addEventListener('click', logout);
        return user;
    } else {
        // User is not logged in
        document.getElementById('auth-link').textContent = 'Login';
        document.getElementById('auth-link').href = 'login.html';
        return null;
    }
}

async function logout() {
    await supabase.auth.signOut();
    window.location.href = 'login.html';
}

// Run on page load
checkAuth();
```

---

## 5. Product Display & Management

### products.js - Fetching Products

```javascript
// Get all products from database
async function getProducts() {
    try {
        const { data, error } = await supabase
            .from('products')
            .select('*')
            .order('created_at', { ascending: false });

        if (error) {
            console.error('Error fetching products:', error);
            return [];
        }

        return data;
    } catch (err) {
        console.error('Error:', err);
        return [];
    }
}

// Display products on page
async function displayProducts() {
    const products = await getProducts();
    const container = document.getElementById('products-container');
    
    container.innerHTML = ''; // Clear existing content

    products.forEach(product => {
        const productCard = `
            <div class="product-card">
                <img src="${product.image_url}" alt="${product.name}">
                <h3>${product.name}</h3>
                <p>${product.description}</p>
                <p class="price">â‚¦${product.price.toFixed(2)}</p>
                <button onclick="addToCart('${product.id}', '${product.name}', ${product.price})">
                    Add to Cart
                </button>
            </div>
        `;
        container.innerHTML += productCard;
    });
}

// Call this when page loads
displayProducts();
```

### Adding Sample Products (Admin Function)

```javascript
async function addProduct(name, description, price, imageUrl, category, stock) {
    const { data, error } = await supabase
        .from('products')
        .insert([
            {
                name: name,
                description: description,
                price: price,
                image_url: imageUrl,
                category: category,
                stock_quantity: stock
            }
        ]);

    if (error) {
        console.error('Error adding product:', error);
    } else {
        console.log('Product added successfully!');
    }
}

// Example usage:
// addProduct('Running Shoes', 'Comfortable sports shoes', 15000, 'images/shoes.jpg', 'Footwear', 50);
```

---

## 6. Shopping Cart Functionality

### cart.js - Cart Management

```javascript
// Get cart from localStorage (browser storage)
function getCart() {
    const cart = localStorage.getItem('cart');
    return cart ? JSON.parse(cart) : [];
}

// Save cart to localStorage
function saveCart(cart) {
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCount();
}

// Add item to cart
function addToCart(productId, productName, price) {
    const cart = getCart();
    
    // Check if product already in cart
    const existingItem = cart.find(item => item.id === productId);
    
    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        cart.push({
            id: productId,
            name: productName,
            price: price,
            quantity: 1
        });
    }
    
    saveCart(cart);
    alert('Product added to cart!');
}

// Remove item from cart
function removeFromCart(productId) {
    let cart = getCart();
    cart = cart.filter(item => item.id !== productId);
    saveCart(cart);
    displayCart(); // Refresh display
}

// Update quantity
function updateQuantity(productId, newQuantity) {
    const cart = getCart();
    const item = cart.find(item => item.id === productId);
    
    if (item) {
        item.quantity = parseInt(newQuantity);
        if (item.quantity <= 0) {
            removeFromCart(productId);
        } else {
            saveCart(cart);
            displayCart();
        }
    }
}

// Calculate total price
function calculateTotal() {
    const cart = getCart();
    return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
}

// Update cart count in navigation
function updateCartCount() {
    const cart = getCart();
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cart-count').textContent = totalItems;
}

// Display cart on cart.html page
function displayCart() {
    const cart = getCart();
    const container = document.getElementById('cart-items');
    
    if (cart.length === 0) {
        container.innerHTML = '<p>Your cart is empty</p>';
        return;
    }
    
    let html = '';
    cart.forEach(item => {
        html += `
            <div class="cart-item">
                <h4>${item.name}</h4>
                <p>Price: â‚¦${item.price.toFixed(2)}</p>
                <input type="number" value="${item.quantity}" min="1" 
                       onchange="updateQuantity('${item.id}', this.value)">
                <p>Subtotal: â‚¦${(item.price * item.quantity).toFixed(2)}</p>
                <button onclick="removeFromCart('${item.id}')">Remove</button>
            </div>
        `;
    });
    
    html += `
        <div class="cart-total">
            <h3>Total: â‚¦${calculateTotal().toFixed(2)}</h3>
            <button onclick="window.location.href='checkout.html'">
                Proceed to Checkout
            </button>
        </div>
    `;
    
    container.innerHTML = html;
}

// Initialize
updateCartCount();
```

---

## 7. Payment Integration

### Option A: Paystack Integration

#### Step 1: Get Paystack Keys
1. Sign up at [paystack.com](https://paystack.com)
2. Go to Settings â†’ API Keys & Webhooks
3. Copy your **Public Key** (for frontend) and **Secret Key** (for backend)

#### Step 2: Add Paystack Script

```html
<!-- Add to checkout.html -->
<script src="https://js.paystack.co/v1/inline.js"></script>
```

#### Step 3: payment.js - Paystack Implementation

```javascript
const PAYSTACK_PUBLIC_KEY = 'pk_test_your_public_key_here';

async function initiatePaystackPayment() {
    // Check if user is logged in
    const user = await checkAuth();
    if (!user) {
        alert('Please login to continue');
        window.location.href = 'login.html';
        return;
    }

    const cart = getCart();
    if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
    }

    const totalAmount = calculateTotal();
    
    // Paystack amount is in kobo (multiply by 100)
    const amountInKobo = totalAmount * 100;

    const handler = PaystackPop.setup({
        key: PAYSTACK_PUBLIC_KEY,
        email: user.email,
        amount: amountInKobo,
        currency: 'NGN',
        ref: 'ORD_' + Math.floor((Math.random() * 1000000000) + 1), // Generate unique reference
        
        callback: function(response) {
            // Payment successful
            console.log('Payment successful! Reference: ' + response.reference);
            saveOrder(response.reference, totalAmount, 'paid');
        },
        
        onClose: function() {
            alert('Payment window closed.');
        }
    });

    handler.openIframe();
}
```

### Option B: Flutterwave Integration

#### Step 1: Get Flutterwave Keys
1. Sign up at [flutterwave.com](https://flutterwave.com)
2. Go to Settings â†’ API
3. Copy your **Public Key**

#### Step 2: Add Flutterwave Script

```html
<!-- Add to checkout.html -->
<script src="https://checkout.flutterwave.com/v3.js"></script>
```

#### Step 3: payment.js - Flutterwave Implementation

```javascript
const FLUTTERWAVE_PUBLIC_KEY = 'FLWPUBK_TEST-your_public_key_here';

async function initiateFlutterwavePayment() {
    const user = await checkAuth();
    if (!user) {
        alert('Please login to continue');
        window.location.href = 'login.html';
        return;
    }

    const cart = getCart();
    if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
    }

    const totalAmount = calculateTotal();
    const transactionRef = 'ORD_' + Date.now();

    FlutterwaveCheckout({
        public_key: FLUTTERWAVE_PUBLIC_KEY,
        tx_ref: transactionRef,
        amount: totalAmount,
        currency: 'NGN',
        payment_options: 'card, banktransfer, ussd',
        customer: {
            email: user.email,
            name: user.user_metadata.full_name || 'Customer',
        },
        customizations: {
            title: 'MyStore Purchase',
            description: 'Payment for items in cart',
            logo: 'https://your-logo-url.com/logo.png',
        },
        callback: function(data) {
            console.log('Payment successful!', data);
            if (data.status === 'successful') {
                saveOrder(data.transaction_id, totalAmount, 'paid');
            }
        },
        onclose: function() {
            alert('Payment window closed');
        },
    });
}
```

---

## 8. Order Management

### Saving Orders to Database

```javascript
async function saveOrder(paymentReference, totalAmount, status) {
    const user = await checkAuth();
    const cart = getCart();

    try {
        // 1. Create order record
        const { data: orderData, error: orderError } = await supabase
            .from('orders')
            .insert([{
                user_id: user.id,
                total_amount: totalAmount,
                status: status,
                payment_reference: paymentReference
            }])
            .select();

        if (orderError) {
            console.error('Error creating order:', orderError);
            return;
        }

        const orderId = orderData[0].id;

        // 2. Create order items
        const orderItems = cart.map(item => ({
            order_id: orderId,
            product_id: item.id,
            quantity: item.quantity,
            price: item.price
        }));

        const { error: itemsError } = await supabase
            .from('order_items')
            .insert(orderItems);

        if (itemsError) {
            console.error('Error saving order items:', itemsError);
            return;
        }

        // 3. Clear cart
        localStorage.removeItem('cart');
        updateCartCount();

        // 4. Redirect to success page
        alert('Order placed successfully!');
        window.location.href = 'orders.html';

    } catch (err) {
        console.error('Error saving order:', err);
        alert('There was an error processing your order');
    }
}
```

### Displaying Order History

```javascript
async function displayOrders() {
    const user = await checkAuth();
    if (!user) {
        window.location.href = 'login.html';
        return;
    }

    const { data: orders, error } = await supabase
        .from('orders')
        .select(`
            *,
            order_items (
                *,
                products (name, image_url)
            )
        `)
        .eq('user_id', user.id)
        .order('created_at', { ascending: false });

    if (error) {
        console.error('Error fetching orders:', error);
        return;
    }

    const container = document.getElementById('orders-container');
    
    if (orders.length === 0) {
        container.innerHTML = '<p>No orders yet</p>';
        return;
    }

    let html = '';
    orders.forEach(order => {
        html += `
            <div class="order">
                <h3>Order #${order.id.substring(0, 8)}</h3>
                <p>Date: ${new Date(order.created_at).toLocaleDateString()}</p>
                <p>Status: ${order.status}</p>
                <p>Total: â‚¦${order.total_amount.toFixed(2)}</p>
                <div class="order-items">
                    ${order.order_items.map(item => `
                        <div class="order-item">
                            <img src="${item.products.image_url}" alt="${item.products.name}">
                            <p>${item.products.name}</p>
                            <p>Qty: ${item.quantity}</p>
                            <p>â‚¦${item.price.toFixed(2)}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    });

    container.innerHTML = html;
}
```

---

## 9. Best Practices & Security

### Security Tips

1. **Never expose secret keys in frontend code**
   - Only use public/anon keys in JavaScript
   - Keep secret keys on the server side only

2. **Use Row Level Security (RLS) in Supabase**
   ```sql
   -- Allow users to only see their own orders
   ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

   CREATE POLICY "Users can view own orders"
   ON orders FOR SELECT
   USING (auth.uid() = user_id);
   ```

3. **Validate payment on the backend**
   - Never trust frontend payment confirmations alone
   - Always verify with Paystack/Flutterwave webhook

4. **Input validation**
   ```javascript
   function validateEmail(email) {
       const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
       return re.test(email);
   }

   function validatePassword(password) {
       return password.length >= 8;
   }
   ```

### Performance Tips

1. **Optimize images**
   - Compress images before uploading
   - Use appropriate image sizes

2. **Cache data when possible**
   ```javascript
   // Cache products for 5 minutes
   let productsCache = null;
   let cacheTime = null;

   async function getProducts() {
       const now = Date.now();
       if (productsCache && cacheTime && (now - cacheTime < 300000)) {
           return productsCache;
       }

       const products = await fetchProductsFromDatabase();
       productsCache = products;
       cacheTime = now;
       return products;
   }
   ```

3. **Use loading indicators**
   ```javascript
   function showLoading() {
       document.getElementById('loading').style.display = 'block';
   }

   function hideLoading() {
       document.getElementById('loading').style.display = 'none';
   }
   ```

### User Experience Tips

1. **Show feedback for all actions**
   - Loading spinners during API calls
   - Success/error messages
   - Form validation feedback

2. **Make the site responsive**
   ```css
   /* Mobile-first approach */
   .product-card {
       width: 100%;
   }

   @media (min-width: 768px) {
       .product-card {
           width: 48%;
       }
   }

   @media (min-width: 1024px) {
       .product-card {
           width: 23%;
       }
   }
   ```

3. **Handle errors gracefully**
   ```javascript
   async function fetchData() {
       try {
           const data = await someAsyncOperation();
           return data;
       } catch (error) {
           console.error('Error:', error);
           alert('Something went wrong. Please try again.');
           return null;
       }
   }
   ```

---

## ðŸŽ“ Practice Exercises

### Exercise 1: Add Product Search
Create a search bar that filters products by name

### Exercise 2: Product Categories
Add category filtering to show only products from selected categories

### Exercise 3: Wishlist Feature
Create a wishlist where users can save products for later

### Exercise 4: Order Status Updates
Allow admin users to update order status (pending â†’ processing â†’ shipped â†’ delivered)

### Exercise 5: Product Reviews
Let users leave reviews and ratings for products they've purchased

---

## ðŸ”— Helpful Resources

- **Supabase Docs:** https://supabase.com/docs
- **Paystack Docs:** https://paystack.com/docs
- **Flutterwave Docs:** https://developer.flutterwave.com/docs
- **MDN Web Docs:** https://developer.mozilla.org
- **JavaScript Tutorial:** https://javascript.info

---

## ðŸ“ Common Errors & Solutions

### Error: "Invalid API Key"
**Solution:** Check that you copied the correct keys from Supabase/Paystack/Flutterwave

### Error: "CORS Error"
**Solution:** Make sure you're accessing your site through a proper server (use Live Server extension in VS Code, not file://)

### Error: Cart not updating
**Solution:** Check browser console for errors, ensure localStorage is enabled

### Error: Payment not processing
**Solution:** Verify you're using test keys in development, check network tab for failed requests

---

## ðŸš€ Next Steps

After completing this project, you can:
1. Deploy your site using Netlify, Vercel, or GitHub Pages
2. Add more features like discount codes, shipping options
3. Integrate email notifications using Supabase Edge Functions
4. Add an admin dashboard for managing products
5. Implement inventory management

---

**Remember:** Start small, test frequently, and build one feature at a time. Good luck with your e-commerce project! ðŸŽ‰